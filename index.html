<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ConnectX - お金診断アプリ</title>
    <meta name="description" content="あなたに最適な金融商品を診断します">
    
    <!-- PWAメタタグ -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#3b82f6" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="AI ConnectX" />
    <link rel="apple-touch-icon" href="/pwa-192x192.png" />
    <meta name="mobile-web-app-capable" content="yes" />
    
    <!-- PWAアイコン -->
    <link rel="icon" type="image/png" sizes="192x192" href="/pwa-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/pwa-512x512.png" />
    <link rel="icon" href="/favicon.ico" />
    
    <!-- SEOメタタグ -->
    <meta property="og:title" content="AI ConnectX - お金診断アプリ" />
    <meta property="og:description" content="あなたに最適な金融商品を診断します" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/pwa-512x512.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="AI ConnectX - お金診断アプリ" />
    <meta name="twitter:description" content="あなたに最適な金融商品を診断します" />
    
    <!-- Normalize CSS - ブラウザ差異を統一 -->
    <link rel="stylesheet" href="/normalize.css">
    
    <!-- モダンデザインシステム -->
    <link rel="stylesheet" href="/modern-design.css">
    
    <!-- フォント読み込み最適化 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- 直接スタイル読み込み - CDN不要 -->
    <style>
        /* === 完全リセット CSS === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Noto Sans JP', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            background: #ffffff;
            color: #243b53;
        }
        
        /* === 確実なユーティリティクラス === */
        .container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 0 1rem !important;
        }
        
        .flex {
            display: flex !important;
        }
        
        .items-center {
            align-items: center !important;
        }
        
        .justify-center {
            justify-content: center !important;
        }
        
        .justify-between {
            justify-content: space-between !important;
        }
        
        .grid {
            display: grid !important;
        }
        
        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
        }
        
        .grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
        }
        
        .gap-8 {
            gap: 2rem !important;
        }
        
        .w-full {
            width: 100% !important;
        }
        
        .text-center {
            text-align: center !important;
        }
        
        .bg-white {
            background-color: #ffffff !important;
        }
        
        .py-16 {
            padding-top: 4rem !important;
            padding-bottom: 4rem !important;
        }
        
        .px-4 {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }
        
        .mb-16 {
            margin-bottom: 4rem !important;
        }
        
        .mx-auto {
            margin-left: auto !important;
            margin-right: auto !important;
        }
        
        /* === 確実なレスポンシブ対応 === */
        @media (max-width: 768px) {
            .grid-cols-2,
            .grid-cols-3 {
                grid-template-columns: 1fr !important;
            }
            
            .container {
                padding: 0 0.5rem !important;
            }
        }
    </style>
    
    <!-- アクセシビリティスタイル -->
    <link rel="stylesheet" href="/src/styles/accessibility.css">
</head>
<body>
    <div id="root"></div>
    
    <!-- CDN読み込み監視とフォールバック処理 -->
    <script>
        // 改善されたフォント読み込み確認
        if ('fonts' in document) {
            document.fonts.ready.then(function() {
                console.log('フォントの読み込み完了');
                document.body.classList.add('fonts-loaded');
            }).catch(function() {
                console.warn('フォントの読み込みに問題が発生');
                // フォールバックフォントを強制適用
                document.body.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
            });
        } else {
            // 古いブラウザ向けフォールバック
            window.addEventListener('load', function() {
                setTimeout(function() {
                    document.body.classList.add('fonts-loaded');
                }, 1000);
            });
        }
        
        // Tailwind CSS読み込み確認とフォールバック処理
        function checkTailwindCSS() {
            // 強制的にフォールバックCSSを読み込み（確実性重視）
            setTimeout(() => {
                loadFallbackCSS();
            }, 100);
        }
        
        // フォールバックCSS読み込み
        function loadFallbackCSS() {
            const fallbackLink = document.createElement('link');
            fallbackLink.rel = 'stylesheet';
            fallbackLink.href = '/tailwind-fallback.css';
            fallbackLink.onload = function() {
                console.log('フォールバックCSS読み込み完了');
                document.body.classList.add('tailwind-fallback');
            };
            fallbackLink.onerror = function() {
                console.error('フォールバックCSS読み込み失敗');
                // 最終手段として、重要なスタイルをインラインで適用
                applyEmergencyStyles();
            };
            document.head.appendChild(fallbackLink);
        }
        
        // 緊急時のインラインスタイル適用
        function applyEmergencyStyles() {
            const emergencyStyles = `
                .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
                .flex { display: flex; }
                .items-center { align-items: center; }
                .justify-center { justify-content: center; }
                .justify-between { justify-content: space-between; }
                .grid { display: grid; }
                .gap-4 { gap: 1rem; }
                .gap-8 { gap: 2rem; }
                .w-full { width: 100%; }
                .text-center { text-align: center; }
                .bg-white { background-color: white; }
                .text-white { color: white; }
                .p-4 { padding: 1rem; }
                .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
                .mb-4 { margin-bottom: 1rem; }
                .mb-8 { margin-bottom: 2rem; }
                .mx-auto { margin-left: auto; margin-right: auto; }
                .rounded-lg { border-radius: 0.5rem; }
                .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
                .border { border-width: 1px; }
                .border-gray-200 { border-color: #e5e7eb; }
                @media (max-width: 768px) { 
                    .md\\:grid-cols-2, .md\\:grid-cols-3 { grid-template-columns: 1fr; } 
                    .container { padding: 0 0.5rem; }
                }
            `;
            
            const styleEl = document.createElement('style');
            styleEl.textContent = emergencyStyles;
            document.head.appendChild(styleEl);
            console.log('緊急スタイル適用完了');
        }
        
        // DOMContentLoaded後にチェック実行
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', checkTailwindCSS);
        } else {
            checkTailwindCSS();
        }
        
        // CSSの読み込み完了を確認
        function checkCSSLoad() {
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            let loadedCount = 0;
            let totalCount = links.length;
            
            links.forEach(link => {
                if (link.sheet) {
                    loadedCount++;
                } else {
                    link.addEventListener('load', () => {
                        loadedCount++;
                        if (loadedCount === totalCount) {
                            console.log('すべてのCSSファイルの読み込み完了');
                        }
                    });
                    link.addEventListener('error', (e) => {
                        console.warn('CSSファイルの読み込みエラー:', e.target.href);
                        loadedCount++; // エラーでもカウントを増やしてブロックを防ぐ
                    });
                }
            });
            
            // 既に読み込み済みの場合
            if (loadedCount === totalCount) {
                console.log('すべてのCSSファイルの読み込み完了（既読込）');
            }
        }
        
        checkCSSLoad();
        
        // ページ読み込み後の最終チェック
        window.addEventListener('load', function() {
            setTimeout(() => {
                // 基本的なスタイルが適用されているかの最終確認
                const bodyStyle = window.getComputedStyle(document.body);
                if (bodyStyle.fontFamily.includes('Inter') || bodyStyle.fontFamily.includes('system-ui')) {
                    console.log('スタイル適用確認完了');
                } else {
                    console.warn('スタイル適用に問題の可能性があります');
                    // 緊急フォールバック
                    document.body.style.fontFamily = 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif';
                    document.body.style.fontSize = '16px';
                    document.body.style.lineHeight = '1.6';
                }
            }, 1000);
        });
    </script>
    
    <script type="module" src="/index.tsx"></script>
</body>
</html>