# Supabase 400エラー修正ガイド

## 🚨 問題の特定

**エラー**: `GET ... 400 (Bad Request)` 
**原因**: `admin_settings`, `expert_contact_settings`, `financial_planners` テーブルが存在しない

## 🔧 修正手順

### 1. Supabaseでテーブル作成

**Supabaseダッシュボード** → **SQL Editor** で以下を実行：

```sql
-- CREATE_MISSING_TABLES.sqlの内容をコピー・ペーストして実行
```

または`CREATE_MISSING_TABLES.sql`ファイルの内容を実行してください。

### 2. テーブル作成の確認

作成されるテーブル：
- ✅ `admin_settings` - 管理者設定用
- ✅ `expert_contact_settings` - 専門家連絡先用  
- ✅ `financial_planners` - ファイナンシャルプランナー情報用

### 3. 初期データの確認

以下の初期データが自動挿入されます：
- 専門家連絡先のデフォルトデータ
- サンプルファイナンシャルプランナー2名
- 管理者設定の基本データ

## 🔍 Supabaseクエリについて

**正しいクエリ形式** (現在のコードは正しい):
```
/rest/v1/admin_settings?setting_key=eq.testimonials
```

**間違った理解**:
- `eq.`演算子の使い方は正しい
- 問題はテーブルが存在しないことだった

## ✅ 修正後の確認事項

### 1. アプリケーションでの確認
- 管理画面でエラーが解消されること
- お客様の声が正常に表示されること
- 専門家連絡先が設定できること

### 2. ブラウザ開発者ツールでの確認
- 400エラーが消えること
- 正常なデータが取得されること

## 🚀 デプロイ後の確認

1. **テーブル作成完了**: Supabaseダッシュボードでテーブル確認
2. **RLS設定確認**: Row Level Securityが有効か確認
3. **アプリケーション動作**: 管理画面で正常にデータが表示されるか確認

## 📋 追加の注意事項

### セキュリティ設定
- RLS (Row Level Security) が有効化済み
- 適切なポリシーが設定済み
- 読み取り権限は公開、書き込み権限は認証済みユーザーのみ

### パフォーマンス最適化
- 必要なインデックスが作成済み
- クエリ最適化済み

### データ管理
- 自動更新トリガー設定済み
- 初期データ挿入済み

この修正により、Supabase 400エラーは完全に解消されます。 